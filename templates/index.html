
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Traffic Predictor (CO₂/NOx/PM2.5)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg:#0b1020; --card:#121936; --muted:#97a0c9; --accent:#6ea8fe; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:linear-gradient(135deg, #0b1020, #101b3a); color:#e9edff; }
    .wrap { max-width:960px; margin:40px auto; padding:0 16px; }
    .card { background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:20px; padding:24px; box-shadow: 0 10px 30px rgba(0,0,0,.3); }
    h1 { font-size:28px; margin:0 0 6px; }
    p { color:var(--muted); margin:0 0 18px; }
    form { display:grid; grid-template-columns: 1fr 1fr 1fr auto; gap:14px; align-items:end; }
    label { font-weight:600; font-size:13px; color:#c9d1ff; display:block; margin-bottom:6px; }
    input[type="number"] { width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:#0d1430; color:#e9edff; outline:none; }
    button { padding:12px 16px; border-radius:12px; border:0; background:var(--accent); color:#07122e; font-weight:700; cursor:pointer; }
    .result { margin-top:18px; padding:14px 16px; border-radius:12px; background:#0d1430; border:1px solid rgba(255,255,255,.06); display:none; }
    .metrics { margin-top:16px; display:flex; gap:12px; flex-wrap:wrap; }
    .badge { background:#0d1430; border:1px solid rgba(255,255,255,.06); border-radius:999px; padding:8px 12px; font-size:12px; color:#c9d1ff; }
    footer { margin-top:20px; text-align:center; color:#7f8ac6; font-size:12px; }
    @media (max-width: 860px) { form { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Traffic Predictor</h1>
      <p>Enter emissions to estimate <strong>Vehicle Count</strong> using your Random Forest model.</p>

      <div class="metrics">
        <div class="badge">R²: {{ '%.3f'|format(metrics.r2) }}</div>
        <div class="badge">MAE: {{ '%.2f'|format(metrics.mae) }}</div>
        <div class="badge">RMSE: {{ '%.2f'|format(metrics.rmse) }}</div>
        <div class="badge">Features: {{ features | join(', ') }}</div>
      </div>

      <form id="predict-form">
        <div>
          <label for="co2">CO₂ Emissions (g/km)</label>
          <input id="co2" name="co2" type="number" step="0.01" placeholder="e.g., 120" required>
        </div>
        <div>
          <label for="nox">NOx Emissions (mg/km)</label>
          <input id="nox" name="nox" type="number" step="0.01" placeholder="e.g., 80" required>
        </div>
        <div>
          <label for="pm25">PM2.5 Concentration (µg/m³)</label>
          <input id="pm25" name="pm25" type="number" step="0.01" placeholder="e.g., 60" required>
        </div>
        <button type="submit">Predict</button>
      </form>

      <div id="result" class="result"></div>

      <footer>
        Built for your PBL ML project • Flask + Vanilla JS
      </footer>
    </div>
  </div>

  <script>
    const form = document.getElementById('predict-form');
    const result = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.style.display = 'none';
      const co2 = parseFloat(form.co2.value);
      const nox = parseFloat(form.nox.value);
      const pm25 = parseFloat(form.pm25.value);

      try {
        const res = await fetch('/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ co2, nox, pm25 })
        });
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || 'Prediction failed');
        result.innerHTML = `<strong>Predicted Vehicle Count:</strong> ${data.prediction} <br><em>${data.label}</em>`;
        result.style.display = 'block';
      } catch (err) {
        result.innerHTML = 'Error: ' + err.message;
        result.style.display = 'block';
      }
    });
  </script>
</body>
</html>
